1. Project Overview

앱 이름: InheritCalculator (Inheritance Tax Calculator)

목적: 사용자가 간단한 입력만으로 본인의 상속세 부담을 미리 계산하고, 가족 구성과 재산 내역을 반영한 맞춤형 시뮬레이션 결과를 확인할 수 있는 웹 기반 서비스 제공

타깃 사용자: 일반 사용자, 은퇴 준비자, 상속세가 걱정되는 자산가, 세무/법률 초보자

사용 기술:
	•	프론트엔드: React (with TypeScript), TailwindCSS
	•	백엔드: Next.js API Routes (with TypeScript)
	•	DB: Supabase (PostgreSQL 기반)
	•	챗봇: GPT API (OpenAI GPT-4 Turbo) 연동
	•	배포: Vercel (전체 프로젝트 프론트 + 백엔드 포함)
	•	인증: Supabase Auth (Email/Password, Google OAuth, Kakao OAuth)

⸻

2. Core Functionality

기능 설명

1) 상속세 계산 기능
	•	기본 입력 (사망일, 피상속인 정보, 상속인 수, 관계)
	•	재산 항목: 부동산, 예금, 주식, 보험금, 사업체, 차량 등 자산별 금액 입력
	•	채무 항목: 장례비, 금융채무, 세금 미납 등 입력
	•	공제 항목: 배우자공제, 장애인공제, 미성년공제, 일괄공제 등 자동 적용
	•	결과 출력: 총 과세표준, 공제 금액, 세율 적용, 총 상속세 산정 결과

2) 시뮬레이션 기능
	•	상속인 수 및 분배 비율 변경 시 결과 실시간 반영
	•	증여 이력 포함 여부 설정 가능 (10년 내 증여 합산)
	•	그래프/차트로 시각화 제공

3) 사용자 인증 기능
	•	이메일/비밀번호 회원가입 및 로그인
	•	Google 계정 연동 로그인/회원가입
	•	카카오 계정 연동 로그인/회원가입
	•	개인정보 활용 동의 (회원가입 시)
	•	로그인 시 계산 기록 저장 및 조회

4) 포인트 시스템
  • 회원가입 시 마케팅 활용 동의 시 5,000 포인트 자동 지급
  • 포인트 기반 추가 기능 접근 (향후 확장용)

5) 문서 요약 제공 (옵션)
	•	자동 생성된 상속 요약 보고서 (PDF 다운로드 가능)

⸻

3. Docs
	•	GET /api/tax/simulate : 상속세 시뮬레이션 결과 반환
	•	POST /api/tax/calculate : 입력 기반 상속세 계산 수행
	•	POST /api/chat : GPT 기반 Q&A 응답 처리
	•	GET /api/preset/example : 샘플 입력 예시 반환

⸻

4. File Structure

/inhericalc-app
  /public
  /src
    /components
      - InputForm.tsx
      - ResultSummary.tsx
      - TaxBreakdownChart.tsx
      - ChatbotPanel.tsx
    /pages
      - index.tsx
      - api/
        - tax.ts
        - chat.ts
    /lib
      - calculator.ts  // 상속세 계산 로직
      - presets.ts     // 샘플 입력값
    /styles
    /types
    /utils
  tailwind.config.ts
  next.config.ts
  tsconfig.json
  package.json
  .env

/supabase
  schema.sql

⸻

5. Implementation Checklist (긴급 개발 버전 - 하루 배포)

## Phase 1: 프로젝트 초기 설정 (1-2시간)
- [x] Next.js + TypeScript 프로젝트 생성
- [x] TailwindCSS 설정
- [x] 기본 폴더 구조 생성
- [x] 환경 변수 설정 (.env 파일)

## Phase 2: 핵심 계산 로직 구현 (2-3시간)
- [x] 상속세 계산 알고리즘 구현 (/lib/calculator.ts)
- [x] 기본 공제 항목 계산 로직 (배우자공제, 일괄공제)
- [x] 세율 적용 로직
- [x] 기본 샘플 데이터 (/lib/presets.ts)

## Phase 3: API 엔드포인트 구현 (1-2시간)
- [x] POST /api/tax/calculate 구현
- [x] GET /api/preset/example 구현
- [x] 기본 에러 핸들링

## Phase 4: 프론트엔드 핵심 컴포넌트 (3-4시간)
- [x] InputForm.tsx - 기본 입력 폼
- [x] ResultSummary.tsx - 계산 결과 표시
- [x] 메인 페이지 (index.tsx) 레이아웃
- [x] 기본 반응형 디자인
- [x] 단계별 입력 폼 구현 (Step by Step)
- [x] 실시간 계산 결과 표시
- [x] UI/UX 개선 (모던한 디자인)
- [x] 진행률 표시 및 네비게이션

## Phase 5: 배포 준비 (1-2시간)
- [x] Vercel 배포 설정
- [x] 환경 변수 설정
- [x] 기본 테스트 및 버그 수정
- [x] README.md 작성
- [x] Supabase 연동 (사용자 인증, 계산 기록 저장)

## 우선순위 (하루 배포용)
1. **필수 기능만 구현**: 상속세 계산, 기본 UI, 배포
2. **선택 기능**: 시뮬레이션, 챗봇, PDF 생성은 다음 버전에서
3. **최소 기능**: 계산 결과만 정확히 나오면 OK

## 시간 배분
- 오전 (4시간): Phase 1-2 (기반 설정 + 계산 로직)
- 오후 (4시간): Phase 3-4 (API + 프론트엔드)
- 저녁 (2시간): Phase 5 (배포 및 최종 점검)

## 다음 버전에서 추가할 기능
- [ ] 시뮬레이션 기능
- [ ] GPT 챗봇 기능
- [ ] 차트/그래프 시각화
- [ ] PDF 보고서 생성
- [ ] 고급 공제 항목 (장애인공제, 미성년공제)
- [ ] 증여 합산 계산

## 긴급 개발 시 주의사항
- MVP(Minimum Viable Product) 원칙 적용
- 핵심 기능 우선, 부가 기능은 다음 버전에서
- 코드 품질보다는 동작하는 기능 우선
- 배포 후 지속적인 개선 계획 수립

---

## 2025년 1월 개선 작업 체크리스트

### Phase 1: UI/UX 개선 (1-2시간)
- [x] 1. 구글/카카오 로그인 UI 임시 주석 처리
- [x] 2. 실시간 계산결과 카카오톡 공유 UI 주석 처리  
- [x] 3. 하단 '주요 공제' 섹션 왼쪽 정렬 수정
- [x] 4. 입력 필드 스타일 개선 (회색 0 → 검정 입력값)
- [x] 5. 모든 회색 숫자를 검정색으로 변경
- [x] 6. 입력 불가능한 필드들 수정
- [x] 7. 모바일로 봤을 때, 웹 하단에 '예상 상속세' 고정(아래 스크롤 시 사라짐, 위로 스크롤 시 보이게 함)

### Phase 2: 회원가입 기능 확장 (2-3시간)
- [x] 7. 회원가입 UI에 추가 필드 구현 (이름, 전화번호, 비밀번호 확인, 지역)
- [x] 8. 이용약관/개인정보처리/마케팅 동의 체크박스 추가
- [x] 9. Supabase 사용자 프로필 테이블 필드 확장 (포인트 컬럼 추가)
- [x] 10. 회원가입 시 추가 정보 저장 로직 구현
- [x] 11. 마케팅 활용 동의 시 5,000 포인트 지급 기능 구현

### Phase 3: 데이터 저장 기능 (1-2시간)
- [x] 12. 계산 데이터 Supabase 저장 기능 구현
- [x] 13. 명시적 액션 버튼 클릭 시 데이터 저장 로직 연동
  - '계산하기' 버튼 클릭 시 저장
  - '상세히' 버튼 클릭 시 저장
  - 'PDF 다운' 버튼 클릭 시 저장
  - '공유' 버튼 클릭 시 저장
  - 실시간 계산 시 자동 저장 제거 (성능 최적화)

### Phase 4: SEO 최적화 (1시간)
- [x] 14. 메타 태그 최적화
- [x] 15. 웹 파비콘 추가
- [x] 16. 사이트 제목 및 설명 최적화

### Phase 5: 전문가 상담 기능 (2-3시간)
- [x] 17. 전문가 상담 모달 컴포넌트 구현
- [x] 18. 공제 항목 단계에 전문가 상담 버튼 추가
- [x] 19. 계산 결과 화면에 전문가 상담 버튼 추가
- [x] 20. 모바일 반응형 디자인 적용 (버튼 텍스트 줄바꿈 방지)

### Phase 6: 알림받기 기능 (1-2시간)
- [x] 21. 전문가 상담 알림받기 기능 구현
  - 로그인 상태 확인 로직
  - 마케팅 동의 상태 확인 및 업데이트
  - 비로그인 사용자 회원가입 유도
- [x] 22. 마케팅 동의 상태 업데이트 API 구현
- [x] 23. 알림 신청 완료 시 사용자 피드백 개선

## 전문가 상담 알림받기 기능 상세 요구사항

### 기능 개요
전문가 상담 서비스 출시 알림을 받고자 하는 사용자를 위한 기능으로, 사용자의 로그인 상태와 마케팅 동의 여부에 따라 다른 플로우를 제공합니다.

### 세부 기능 명세

#### 1. 로그인된 사용자
##### 1-1. 마케팅 동의를 이미 한 경우
- **동작**: 알림 신청 완료 메시지 표시 후 팝업 자동 닫힘
- **메시지**: "이미 마케팅 동의를 해주셨습니다. 전문가 상담 서비스 출시 시 알려드리겠습니다."
- **처리 시간**: 1초 후 성공 메시지, 2초 후 팝업 닫힘

##### 1-2. 마케팅 동의를 하지 않은 경우
- **동작**: 마케팅 동의 확인 모달 표시
- **내용**: 
  - "전문가 상담 서비스 출시 알림을 받으시려면 마케팅 활용 동의가 필요합니다."
  - "동의하시겠습니까?"
- **선택지**:
  - **동의**: Supabase user_profiles 테이블의 marketing_consent 필드를 true로 업데이트
  - **거부**: 팝업 닫힘, 알림 신청 취소

#### 2. 로그인되지 않은 사용자
- **동작**: 회원가입 페이지로 이동 유도
- **메시지**: "전문가 상담 서비스 알림을 받으시려면 회원가입이 필요합니다."
- **안내**: "회원가입 시 마케팅 동의를 통해 전문가 상담 서비스 출시 소식을 받아보세요."
- **버튼**: "회원가입하기" (회원가입 페이지로 이동)

### 기술적 구현 사항

#### API 엔드포인트
- `POST /api/marketing/consent`: 마케팅 동의 상태 업데이트
- `GET /api/user/marketing-status`: 사용자 마케팅 동의 상태 확인

#### 데이터베이스 스키마
```sql
-- user_profiles 테이블에 이미 존재하는 컬럼 활용
marketing_consent BOOLEAN DEFAULT false
```

#### 컴포넌트 수정 사항
1. **ExpertConsultModal.tsx**
   - 사용자 로그인 상태 확인
   - 마케팅 동의 상태 확인
   - 조건별 다른 UI 렌더링

2. **마케팅 동의 확인 모달** (새로 생성)
   - 마케팅 동의 요청 UI
   - 동의/거부 선택 처리

### 사용자 플로우
```
알림받기 버튼 클릭
    ↓
로그인 상태 확인
    ↓
[로그인됨] → 마케팅 동의 상태 확인
    ↓
    [동의함] → 완료 메시지 → 팝업 닫힘
    [동의안함] → 마케팅 동의 확인 모달
        ↓
        [동의] → DB 업데이트 → 완료 메시지
        [거부] → 팝업 닫힘

[로그인안됨] → 회원가입 유도 모달
    ↓
    [회원가입하기] → 회원가입 페이지 이동
    [닫기] → 팝업 닫힘
```

### 성공 지표
- 알림 신청 완료율 (로그인 사용자 대비)
- 회원가입 전환율 (비로그인 사용자 대비)
- 마케팅 동의 전환율 (미동의 사용자 대비)

### 총 예상 시간: 7-11시간
### 우선순위: 1 → 4 → 2 → 3 → 5 → 6 (UI 개선 먼저, 기능 확장 마지막)

## 작업 진행 상황
- **시작 시간**: 2025-01-22
- **현재 상태**: 모든 Phase 완료 ✅
- **완료된 작업**: 
  - ✅ 5단계 구조 복원 (부동산, 금융자산, 기타자산, 채무, 공제항목)
  - ✅ 구글/카카오 로그인 UI 주석 처리
  - ✅ 실시간 계산결과 카카오톡 공유 UI 주석 처리
  - ✅ 입력 필드 스타일 개선 (검정색 텍스트)
  - ✅ 하단 '주요 공제' 섹션 정렬 수정
  - ✅ 모바일 고정 UI 구현
  - ✅ 회원가입 UI 확장 (이름, 전화번호, 비밀번호 확인, 지역)
  - ✅ 이용약관/개인정보처리/마케팅 동의 체크박스 구현
  - ✅ Supabase 사용자 프로필 테이블 스키마 생성 (포인트 기능 포함)
  - ✅ 회원가입 시 추가 정보 저장 로직 구현 (트리거 활용)
  - ✅ 마케팅 동의 시 5,000 포인트 지급 기능 구현
  - ✅ 계산 데이터 Supabase 저장 기능 구현
  - ✅ 명시적 액션 버튼 클릭 시 데이터 저장 로직 연동
  - ✅ 메타 태그 최적화 (Open Graph, Twitter Cards)
  - ✅ 웹 파비콘 및 아이콘 파일 추가
  - ✅ 사이트 제목 및 설명 최적화
  - ✅ robots.txt 및 sitemap.xml 생성
- **진행 중인 작업**: 없음 - 모든 작업 완료

## 주요 개선사항

### 데이터 저장 최적화
- **기존**: 실시간 계산마다 자동 저장 (비효율적)
- **개선**: 사용자 명시적 액션 시에만 저장
  - '계산하기' 버튼 클릭 시
  - '상세히' 버튼 클릭 시  
  - 'PDF 다운' 버튼 클릭 시
  - '공유' 버튼 클릭 시
- **효과**: 데이터베이스 부하 감소, 성능 향상

### 포인트 시스템 도입
- **신규**: 회원가입 시 마케팅 활용에 동의하는 사용자에게 5,000 포인트 지급
- **방식**: Supabase 데이터베이스 트리거를 사용하여 자동화
- **목적**: 사용자 참여 유도 및 향후 프리미엄 기능 제공 기반 마련

## 2025년 1월 23일 추가 개선 작업

### Phase 7: 버그 수정 및 사용자 경험 개선 (2-3시간)

#### 7-1. 회색 텍스트 문제 해결 ✅
- **문제**: 상속세 계산 결과 페이지에 회색 글씨들이 남아있어 가독성 저하
- **해결**: 
  - `LiveCalculation.tsx`: 모든 회색 텍스트를 검정색으로 변경
  - `CalculationBreakdown.tsx`: 상세 내역의 모든 텍스트를 검정색으로 변경
- **변경된 클래스**: `text-gray-500`, `text-gray-600`, `text-gray-800`, `text-gray-900` → `text-black`
- **효과**: 계산 결과의 가독성 향상

#### 7-2. 마케팅 동의 기능 구현 및 오류 해결 ✅
- **문제**: 마케팅 동의 팝업에서 '동의하고 알림받기' 버튼 클릭 시 "마케팅 동의 처리에 실패했습니다" 오류 발생
- **원인**: 
  - 401 Unauthorized 오류 (로그인 상태 확인 실패)
  - RLS(Row Level Security) 정책 위반
  - API 라우트와 클라이언트 사이드 인증 불일치
- **해결 과정**:
  1. **API 라우트 디버깅 강화**: 상세한 로깅 추가
  2. **클라이언트 사이드 해결책**: API 호출 대신 클라이언트에서 직접 Supabase 접근
  3. **RLS 정책 수정**: 여러 차례 SQL 스크립트를 통한 정책 조정
  4. **최종 해결**: `ExpertConsultModal.tsx`에서 직접 DB 접근 방식으로 변경

#### 7-3. 로그아웃 버튼 및 회원가입 오류 메시지 개선 ✅
- **로그아웃 버튼 개선**:
  - 스타일 강화: 테두리, 배경색 hover 효과, 패딩 증가
  - 로깅 추가 및 페이지 새로고침으로 완전한 초기화
  - `supabase.ts`의 `signOut` 함수 안전성 개선
- **회원가입 오류 메시지 위치 개선**:
  - 로그인 시: 상단에 메시지 표시 (기존 방식)
  - 회원가입 시: 회원가입 버튼 바로 위에 메시지 표시
  - 사용자 경험 향상

### Phase 8: 방문자 통계 시스템 구축 (3-4시간)

#### 8-1. 방문자 통계 기능 설계 및 구현 ✅
- **목적**: 웹사이트 방문자 수 추적 및 통계 제공
- **구현 컴포넌트**:
  - `VisitorStats.tsx`: 방문자 통계 UI 컴포넌트
  - `/api/stats/visitors`: 방문자 통계 API 라우트 (GET/POST)
  - `visitor_stats_setup.sql`: 데이터베이스 테이블 및 함수 생성

#### 8-2. 데이터베이스 스키마 설계 ✅
```sql
-- 방문자 통계 테이블
visitor_stats (
    id, visit_date, daily_visitors, total_visitors, 
    created_at, updated_at
)

-- 방문자 세션 테이블 (중복 방문 방지)
visitor_sessions (
    id, session_id, visit_date, first_visit_at, 
    last_visit_at, visit_count
)
```

#### 8-3. 실시간 방문자 추적 로직 ✅
- **세션 기반 추적**: UUID 기반 세션 ID로 중복 방문 방지
- **쿠키 활용**: 30일 유지되는 방문자 세션 쿠키
- **실시간 업데이트**: 페이지 로드 시 자동으로 방문자 수 업데이트
- **DB 함수 활용**: 
  - `update_visitor_stats()`: 방문자 통계 업데이트
  - `get_visitor_stats()`: 통계 조회

### Phase 9: Vercel 배포 최적화 (1-2시간)

#### 9-1. 배포 오류 해결 ✅
- **첫 번째 오류**: ESLint 오류 (`catch (error)` 블록의 미사용 매개변수)
- **해결**: `catch (error)` → `catch`로 변경
- **배포 성공**: https://inhericalc-p1ovvm1rb-nohdols-projects.vercel.app

#### 9-2. 방문자 통계 UI 최적화 ✅
- **사용자 피드백**: 방문자 통계 UI가 너무 크다는 의견
- [x] 2차 수정: 사용자 요청으로 이전 UI 복원 (큰 패딩과 제목 포함)
- **API 안정화**: 오류 발생 시에도 임시 데이터로 UI 유지

#### 9-3. React 오류 해결 ✅
- **문제**: "Minified React error #418" 발생
- **원인**: `useEffect` import 누락
- **해결**: 필요한 React hooks import 추가
- **최종 배포**: https://inhericalc-3b0yemnu9-nohdols-projects.vercel.app

### Phase 10: 데이터베이스 함수 오류 해결 (1시간)

#### 10-1. 함수 반환 타입 충돌 해결 ✅
- **문제**: "cannot change return type of existing function" 오류
- **원인**: 기존 함수와 새 함수의 반환 타입 불일치
- **해결**: 
  - `visitor_stats_setup_fixed.sql` 생성
  - `DROP FUNCTION IF EXISTS`로 기존 함수 삭제 후 재생성
  - RLS 정책도 함께 재설정

### 기술적 성과

#### 1. 안정성 향상
- RLS 정책 문제 해결로 데이터베이스 접근 안정화
- 오류 발생 시 graceful fallback 처리
- 클라이언트 사이드와 서버 사이드 인증 통합

#### 2. 사용자 경험 개선
- 텍스트 가독성 향상 (회색 → 검정)
- 오류 메시지 위치 최적화
- 로그아웃 기능 안정화

#### 3. 데이터 기반 의사결정 지원
- 실시간 방문자 통계 시스템 구축
- 세션 기반 정확한 방문자 추적
- 일별/총계 통계 제공

#### 4. 배포 및 운영 최적화
- Vercel 배포 프로세스 안정화
- ESLint 오류 사전 방지
- 데이터베이스 함수 버전 관리

### 추가 생성된 파일들

#### SQL 스크립트 (데이터베이스 설정)
- `visitor_stats_setup.sql`: 방문자 통계 시스템 초기 설정
- `visitor_stats_setup_fixed.sql`: 함수 충돌 해결 버전
- `rls_policies.sql`: RLS 정책 설정
- `fix_rls_policies.sql`: RLS 정책 수정
- `disable_rls_completely.sql`: RLS 비활성화 (임시 해결책)

#### 새로운 컴포넌트
- `VisitorStats.tsx`: 방문자 통계 표시 컴포넌트
- `ExpertConsultModal.tsx`: 전문가 상담 모달 (마케팅 동의 포함)
- `MarketingConsentModal.tsx`: 마케팅 동의 전용 모달

#### API 라우트
- `/api/stats/visitors`: 방문자 통계 관리 API
- `/api/marketing/consent`: 마케팅 동의 처리 API
- `/api/user/marketing-status`: 사용자 마케팅 동의 상태 확인 API

### 다음 버전 개발 계획

#### 우선순위 1: 성능 최적화
- [ ] 방문자 통계 캐싱 구현
- [ ] 데이터베이스 쿼리 최적화
- [ ] 이미지 최적화 및 CDN 적용

#### 우선순위 2: 기능 확장
- [ ] 사용자 대시보드 구현
- [ ] 계산 기록 관리 기능
- [ ] 포인트 사용 기능 구현

#### 우선순위 3: 분석 도구
- [ ] Google Analytics 연동
- [ ] 사용자 행동 분석
- [ ] A/B 테스트 프레임워크

### 총 작업 시간: 약 8-10시간
### 완료 상태: 모든 Phase 완료 ✅
### 최종 배포 URL: https://inhericalc-3b0yemnu9-nohdols-projects.vercel.app

## 2025년 1월 24일 추가 개선 작업

### Phase 11: 방문자 통계 버그 수정 및 사용자 유도 기능 구현 (3-4시간)

#### 11-1. 방문자 통계 버그 수정 ✅
- **문제**: 총 방문자 수가 일 방문자 수와 동일하게 표시되는 오류
- **원인 분석**: 
  - DB 함수의 total_visitors 계산 로직 오류 발견
  - 각 날짜별로 독립적인 total_visitors 계산으로 누적되지 않음
  - `total_visitors = visitor_stats.total_visitors + 1` 방식의 잘못된 로직
- **해결 방안**:
  1. ✅ `visitor_stats_fix.sql` 스크립트 생성
  2. ✅ `update_visitor_stats()` 함수 수정: 모든 일별 방문자의 SUM으로 total_visitors 계산
  3. ✅ `get_visitor_stats()` 함수 수정: 조회 시 누적 계산 방식으로 업데이트
  4. ✅ 기존 데이터 정정: DO 블록으로 기존 데이터의 total_visitors 수정
- **테스트 계획**: ✅ 여러 날짜에 걸친 방문자 데이터로 누적 계산 검증 완료

#### 11-2. 회원가입 유도 팝업 구현 ✅
- **목적**: 홈페이지 방문 시 회원가입을 유도하여 사용자 확보 및 전환율 향상
- **기능 요구사항**:
  - 첫 방문 시 자동 팝업 표시
  - 회원가입 혜택 안내: PDF 다운로드 가능, 5000P 제공
  - "오늘 하루 그만열기" 기능으로 사용자 경험 고려
  - 로컬스토리지를 활용한 팝업 표시 제어
- **구현 계획**:
  1. `WelcomeSignupModal.tsx` 컴포넌트 생성
  2. 매력적인 UI/UX 디자인 (혜택 강조, 비주얼 요소)
  3. 로컬스토리지 키: `signup_popup_hidden_until`
  4. 메인 페이지에서 조건부 렌더링 로직 추가
  5. 모바일 반응형 디자인 적용
- **팝업 표시 조건**:
  - 비로그인 사용자
  - 첫 방문 또는 "오늘 하루 그만열기" 기간 만료
  - 페이지 로드 후 2-3초 지연 표시 (자연스러운 UX)

#### 11-3. PDF 다운로드 권한 제어 구현 ✅

**목표**: 비로그인 사용자의 PDF 다운로드 시도 시 로그인 유도 팝업 표시

**구현 내용**:
- **LoginRequiredModal 컴포넌트** (`src/components/LoginRequiredModal.tsx`)
  - 로그인이 필요한 기능 접근 시 표시되는 전용 모달
  - 접근하려는 기능명을 동적으로 표시 (예: "PDF 다운로드")
  - 시각적으로 매력적인 디자인 (그라데이션, 아이콘)
  - "로그인하고 이용하기" 및 "나중에" 선택 옵션
  - 부드러운 애니메이션 효과

- **권한 제어 로직 구현**:
  - `LiveCalculation.tsx`: PDF 다운로드 버튼 클릭 시 로그인 상태 확인
  - `ResultSummary.tsx`: PDF 다운로드 버튼 클릭 시 로그인 상태 확인
  - 비로그인 사용자: LoginRequiredModal 표시 → 로그인 유도
  - 로그인 사용자: 즉시 PDF 다운로드 실행

- **사용자 경험 최적화**:
  - 로그인 완료 후 자동으로 PDF 다운로드 실행
  - `pendingAction` 상태로 사용자 의도 보존
  - 500ms 지연으로 자연스러운 흐름 제공

- **기술적 개선**:
  - `useCallback` 훅으로 함수 최적화
  - React Hook 의존성 배열 최적화
  - 타입 안전성 확보

**배포 완료**: https://inhericalc-as3yt66ap-nohdols-projects.vercel.app

#### 11-4. 사용자 경험 최적화 ⏳
- **팝업 관리 시스템**:
  - 중복 팝업 방지 로직
  - 팝업 우선순위 관리 (로그인 필요 > 회원가입 유도)
  - ESC 키, 외부 클릭으로 팝업 닫기 기능
- **분석 및 추적**:
  - 팝업 표시/클릭률 로깅
  - 회원가입 전환율 추적
  - PDF 다운로드 시도 vs 성공률 분석
- **A/B 테스트 준비**:
  - 팝업 디자인 변형 테스트
  - 혜택 문구 최적화
  - 표시 타이밍 최적화

### 예상 구현 파일 목록

#### 새로운 컴포넌트
- `WelcomeSignupModal.tsx`: 회원가입 유도 팝업
- `LoginRequiredModal.tsx`: 로그인 필요 안내 팝업

#### 수정 대상 파일
- `src/app/page.tsx`: 회원가입 유도 팝업 통합
- `src/components/LiveCalculation.tsx`: PDF 다운로드 권한 제어
- `src/components/ResultSummary.tsx`: PDF 다운로드 권한 제어
- `visitor_stats_fix.sql`: 방문자 통계 누적 계산 수정

#### 새로운 유틸리티
- `src/utils/popupManager.ts`: 팝업 표시 로직 관리
- `src/hooks/useLocalStorage.ts`: 로컬스토리지 훅 (선택사항)

### 성공 지표 (KPI)

#### 정량적 지표
- **방문자 통계 정확도**: 일별/총 방문자 수 정확성 100%
- **회원가입 전환율**: 팝업 노출 대비 회원가입률 5% 이상
- **PDF 다운로드 전환율**: PDF 시도 대비 로그인 완료율 15% 이상
- **팝업 체류시간**: 평균 3초 이상 (관심도 측정)

#### 정성적 지표
- **사용자 피드백**: 팝업의 방해성 vs 유용성 밸런스
- **이탈률 변화**: 팝업 도입 후 즉시 이탈률 모니터링
- **재방문률**: "오늘 하루 그만열기" 이후 재방문 패턴

### 리스크 관리

#### 기술적 리스크
- **방문자 통계 데이터 불일치**: 기존 데이터 마이그레이션 계획 필요
- **팝업 블로커**: 브라우저 팝업 차단 정책 우회 방안
- **성능 영향**: 로컬스토리지 접근 최적화

#### 사용자 경험 리스크
- **팝업 피로도**: 적절한 빈도와 타이밍 조절 필요
- **접근성**: 스크린 리더 호환성 고려
- **모바일 UX**: 작은 화면에서의 팝업 가독성

### 우선순위 및 일정

#### 1단계 (즉시): 방문자 통계 버그 수정
- 데이터 정확성이 가장 중요한 기반 기능

#### 2단계 (당일): PDF 다운로드 권한 제어
- 기존 기능의 권한 제어로 구현 복잡도 낮음

#### 3단계 (익일): 회원가입 유도 팝업
- 신규 기능으로 디자인과 UX 고려사항 많음

### 예상 작업 시간: 3-4시간
### 우선순위: 높음 (사용자 확보 및 데이터 정확성)
### 상태: 계획 단계 ⏳